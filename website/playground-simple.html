<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TONL Playground - Simple</title>
    <link rel="stylesheet" href="style.css">
        <style>
        body { font-family: system-ui, -apple-system, sans-serif; }
        textarea { font-family: 'Courier New', monospace; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-4xl font-bold mb-8 text-center">TONL Playground</h1>

        <!-- Example Buttons -->
        <div class="mb-6 flex gap-2 flex-wrap justify-center">
            <button data-example="users" class="example-btn px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">üë• Users</button>
            <button data-example="employees" class="example-btn px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">üëî Employees (20)</button>
            <button data-example="products" class="example-btn px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">üõçÔ∏è Products (22)</button>
            <button data-example="transactions" class="example-btn px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">üí∞ Transactions (20)</button>
            <button data-example="apiLogs" class="example-btn px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">üìã API Logs (20)</button>
            <button data-example="config" class="example-btn px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">‚öôÔ∏è Config</button>
        </div>

        <!-- Error Display -->
        <div id="error" class="hidden mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded"></div>

        <!-- Stats -->
        <div class="mb-6 bg-white p-4 rounded-lg shadow">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                <div>
                    <div class="text-sm text-gray-600">JSON Bytes</div>
                    <div id="jsonBytes" class="text-2xl font-bold text-blue-600">0</div>
                </div>
                <div>
                    <div class="text-sm text-gray-600">TONL Bytes</div>
                    <div id="tonlBytes" class="text-2xl font-bold text-green-600">0</div>
                </div>
                <div>
                    <div class="text-sm text-gray-600">JSON Tokens</div>
                    <div id="jsonTokens" class="text-2xl font-bold text-blue-600">0</div>
                </div>
                <div>
                    <div class="text-sm text-gray-600">TONL Tokens</div>
                    <div id="tonlTokens" class="text-2xl font-bold text-green-600">0</div>
                </div>
            </div>
            <div class="mt-4 text-center">
                <span class="text-lg font-bold text-emerald-600">Savings: </span>
                <span id="byteSavings" class="text-lg font-bold text-emerald-600">0%</span> bytes,
                <span id="tokenSavings" class="text-lg font-bold text-emerald-600">0%</span> tokens
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="mb-4 flex gap-2 justify-center">
            <button id="convertToTONLBtn" class="px-6 py-3 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 font-bold">‚Üí Convert to TONL</button>
            <button id="convertToJSONBtn" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-bold">‚Üê Convert to JSON</button>
        </div>

        <!-- Converter -->
        <div class="grid md:grid-cols-2 gap-6">
            <!-- JSON Input -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">JSON Input</h2>
                <textarea id="jsonInput" rows="25" class="w-full p-3 border border-gray-300 rounded font-mono text-sm">{
  "users": [
    {"id": 1, "name": "Alice", "role": "admin"},
    {"id": 2, "name": "Bob", "role": "user"}
  ]
}</textarea>
            </div>

            <!-- TONL Output -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">TONL Output</h2>
                <textarea id="tonlOutput" rows="25" class="w-full p-3 border border-gray-300 rounded font-mono text-sm"></textarea>
            </div>
        </div>
    </div>

    <!-- Load TONL library -->
    <script src="js/tonl.iife.js"></script>

    <!-- Main application script -->
    <script>
        // Global state
        let jsonInput, tonlOutput, errorDiv;

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Get DOM elements
            jsonInput = document.getElementById('jsonInput');
            tonlOutput = document.getElementById('tonlOutput');
            errorDiv = document.getElementById('error');

            // Attach event listeners to buttons
            const exampleButtons = document.querySelectorAll('.example-btn');
            exampleButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    loadExample(this.dataset.example);
                });
            });

            document.getElementById('convertToTONLBtn').addEventListener('click', convertToTONL);
            document.getElementById('convertToJSONBtn').addEventListener('click', convertToJSON);

            // Initialize with users example
            loadExample('users');
        });

        // Load example from JSON file
        async function loadExample(type) {
            if (!jsonInput) {
                console.error('DOM not ready');
                return;
            }

            try {
                hideError();
                const response = await fetch(`json/${type}.json`);
                if (!response.ok) throw new Error(`Failed to load ${type}.json`);

                const data = await response.json();
                jsonInput.value = JSON.stringify(data, null, 2);
                convertToTONL();
            } catch (error) {
                showError('Error loading example: ' + error.message);
            }
        }

        // Convert JSON to TONL
        function convertToTONL() {
            if (!jsonInput || !tonlOutput) return;

            try {
                hideError();
                const data = JSON.parse(jsonInput.value);

                if (typeof TONL !== 'undefined' && TONL.encodeTONL) {
                    tonlOutput.value = TONL.encodeTONL(data);
                    updateStats();
                } else {
                    throw new Error('TONL library not loaded');
                }
            } catch (error) {
                showError('JSON Parse Error: ' + error.message);
            }
        }

        // Convert TONL to JSON
        function convertToJSON() {
            if (!jsonInput || !tonlOutput) return;

            try {
                hideError();
                if (typeof TONL !== 'undefined' && TONL.decodeTONL) {
                    const data = TONL.decodeTONL(tonlOutput.value);
                    jsonInput.value = JSON.stringify(data, null, 2);
                    updateStats();
                } else {
                    throw new Error('TONL library not loaded');
                }
            } catch (error) {
                showError('TONL Decode Error: ' + error.message);
            }
        }

        // Update statistics
        function updateStats() {
            const jsonBytes = new Blob([jsonInput.value]).size;
            const tonlBytes = new Blob([tonlOutput.value]).size;
            const jsonTokens = Math.ceil(jsonInput.value.length / 3.5);
            const tonlTokens = Math.ceil(tonlOutput.value.length / 3.5);

            document.getElementById('jsonBytes').textContent = jsonBytes.toLocaleString();
            document.getElementById('tonlBytes').textContent = tonlBytes.toLocaleString();
            document.getElementById('jsonTokens').textContent = jsonTokens.toLocaleString();
            document.getElementById('tonlTokens').textContent = tonlTokens.toLocaleString();

            if (jsonBytes > 0 && tonlBytes > 0) {
                const byteSavings = Math.round(((jsonBytes - tonlBytes) / jsonBytes) * 100);
                const tokenSavings = Math.round(((jsonTokens - tonlTokens) / jsonTokens) * 100);
                document.getElementById('byteSavings').textContent = Math.max(0, byteSavings) + '%';
                document.getElementById('tokenSavings').textContent = Math.max(0, tokenSavings) + '%';
            }
        }

        // Show error message
        function showError(message) {
            if (errorDiv) {
                errorDiv.textContent = '‚ùå ' + message;
                errorDiv.classList.remove('hidden');
            }
        }

        // Hide error message
        function hideError() {
            if (errorDiv) {
                errorDiv.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
